{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome","text":"<p>A simple, standards-compliant HTTP backend for Terraform (and OpenTofu) that stores state files in MongoDB.</p> <p>Tip</p> <p>Instead of relying on vendor-specific storage or local files, this backend lets you use MongoDB - a mature, horizontally scalable document database - as the storage layer for your Terraform state.</p> <p>Since Terraform state is already JSON, MongoDB is a natural and efficient fit.</p>"},{"location":"#key-features","title":"Key features","text":"<ul> <li>Full Terraform HTTP backend compliance - works out-of-the-box with terraform <code>{ backend \"http\" }</code> (and OpenTofu)</li> <li>Leverages MongoDB strengths - high availability, replication, sharding, and strong performance for JSON documents</li> <li>No vendor lock-in - you control your MongoDB cluster (self-hosted, Atlas, Cosmos DB, etc.)</li> <li>Fine-grained access control - per-workspace (tenant) isolation</li> <li>State file encryption at rest - optional server-side encryption using MongoDB's native encrypted storage engine or client-side encryption</li> <li>Locking support implemented - Terraform checks and prevents concurrent modifications</li> <li>Minimal dependencies - simple open-source code, shipped in an image using SUSE BCI for security and performance</li> <li>Audit trail - all state operations logged with workspace, user/agent, and timestamp</li> </ul>"},{"location":"#when-to-use-this-backend","title":"When to use this backend","text":"<ul> <li>You already run MongoDB in your organization</li> <li>You want a highly available, globally distributed state store without adding another vendor</li> <li>You need strong RBAC and encryption controls</li> <li>You prefer running one container instead of managing S3</li> <li>You wish to integrate Terraform with your infrastructure management system</li> <li>You want to a single, highly available source of truth</li> </ul>"},{"location":"architecture/","title":"Architecture","text":"<p>Terraform Backend MongoDB makes the link between Terraform and MongoDB, two industry standards. It's an integration, not a new application.</p>"},{"location":"architecture/#high-level-view","title":"High-level view","text":""},{"location":"project/","title":"Project","text":""},{"location":"project/#design","title":"Design","text":"<p>The application is written in C# / .NET: open-source, cross-platform (Linux/Windows), highly performant, object-oriented.</p>"},{"location":"project/#automation","title":"Automation","text":"<p>Application lifecycle management is done through GitHub.</p> <p>GitHub Actions are triggered to automate the integration and delivery of the application.</p> Name Role Actions CI Continuous Integration Checks the quality of the code and any vulnerability PKG Continuous Delivery Build the artifacts (container image) Pages Continuous Documentation Build and deploy the documentation"},{"location":"project/#backlog","title":"Backlog","text":""},{"location":"project/#v20-coming-in-2026","title":"V2.0 (coming in 2026)","text":"<p>Feature requests:</p> <ul> <li> Store in the database only one version of the state in tf_state (the latest) and save the others in tf_state_revision</li> <li> Send traces, logs, metrics to OpenTelemetry Collector</li> </ul>"},{"location":"quickstart/","title":"Quickstart","text":""},{"location":"quickstart/#demo","title":"Demo","text":"<p>This is a complete walkthrough to see Terraform Backend MongoDB in action.</p> <ol> <li> <p>Make sure the following tools are available from the commande line:</p> <ul> <li>Docker</li> <li>Terraform</li> </ul> </li> <li> <p>Run the application and the database in containers:</p> Docker <pre><code>curl -O https://raw.githubusercontent.com/devpro/terraform-backend-mongodb/refs/heads/main/compose.yaml\ndocker compose up\n</code></pre> <p>You can view and work with the REST API definitions through the Swagger web page on localhost:9001</p> </li> <li> <p>Create a user to authenticate calls:</p> Docker <pre><code>curl -O https://raw.githubusercontent.com/devpro/terraform-backend-mongodb/refs/heads/main/scripts/tfbeadm &amp;&amp; chmod +x ./tfbeadm\nMONGODB_CONTAINERNAME=tfbackmdb-mongodb-1 MONGODB_CONTAINERNETWORK=tfbackmdb_default ./tfbeadm create-user admin admin123 dummy\n</code></pre> </li> <li> <p>Write Terraform files from a pre-configured sample:</p> Docker <pre><code>curl -O https://raw.githubusercontent.com/devpro/terraform-backend-mongodb/refs/heads/main/samples/local-files/main.tf\n</code></pre> </li> <li> <p>Prepare the working directory for use with Terraform:</p> <pre><code>terraform init\n</code></pre> </li> <li> <p>Performs the operations indicated in Terraform project files:</p> <pre><code>terraform apply\n</code></pre> </li> <li> <p>Query the state database to see the Terraform state information:</p> Docker <pre><code>docker run --rm --link \"tfbackmdb-mongodb-1\" --network \"tfbackmdb_default\" \"mongo:8.2\" \\\n  bash -c \"mongosh \\\"mongodb://mongodb:27017/terraform_backend_dev\\\" --eval 'db.tf_state.find().projection({tenant: 1, name: 1, createdAt: 1, \\\"value.version\\\": 1, \\\"value.resources.type\\\": 1, \\\"value.resources.name\\\": 1})'\"\n</code></pre> </li> <li> <p>Destroy the resources that were created with Terraform:</p> <pre><code>terraform destroy\n</code></pre> </li> </ol>"},{"location":"setup/","title":"Setup","text":""},{"location":"setup/#requirements","title":"Requirements","text":""},{"location":"setup/#database-server","title":"Database server","text":"<p>The application needs a MongoDB database that can be hosted in a:</p> <ul> <li>MongoDB Cluster managed by Atlas (easiest solution, free tier available)</li> <li>MongoDB Replica Set running from release binaries on one or multiple servers</li> <li>MongoDB Replica Set running in containers from MongoDB container image (available on DockerHub)</li> <li>Kubernetes cluster using MongoDB Community or Enterprise Kubernetes Operator</li> </ul> <p>Once the database is available, grab the connection string for a user with admin permissions.</p> <p>Tip</p> <p>Double check any network/security restrictions such as MongoDB IP access list as the application needs to access the MongoDB server</p>"},{"location":"setup/#database-indexes","title":"Database indexes","text":"<p>Add indexes for optimal performances:</p> CommandsScript <pre><code>db.tf_state.createIndex({\"tenant\": 1, \"name\": 1})\ndb.tf_state_lock.createIndex({\"tenant\": 1, \"name\": 1}, {unique: true})\ndb.user.createIndex({\"username\": 1}, {unique: true})\n</code></pre> <pre><code>curl -O https://raw.githubusercontent.com/devpro/terraform-backend-mongodb/refs/heads/main/scripts/tfbeadm\nMONGODB_URI=mongodb://&lt;myserver&gt;:27017/&lt;mydb&gt; tfbeadm create-indexes\n</code></pre> <p>Warning</p> <p><code>mongosh</code> or <code>Docker</code> must be available on the machine running the commands</p>"},{"location":"setup/#installation","title":"Installation","text":""},{"location":"setup/#kubernetes","title":"Kubernetes","text":"<p>Add the Helm chart repository:</p> <pre><code>helm repo add devpro https://devpro.github.io/helm-charts\nhelm repo update\n</code></pre> <p>Create a values.yaml file with your configuration by looking at examples:</p> Traefik Ingress with Let's Encrypt cert-manager issuerDevelopment environment with SwaggerEmbedded MongoDB chart <pre><code>webapi:\n  host: tfbackend.mydomain\ningress:\n  enabled: true\n  className: traefik\n  annotations:\n    cert-manager.io/cluster-issuer: letsencrypt-prod\n</code></pre> <pre><code>dotnet:\n  environment: Development\n  enableSwagger: true\n  enableOpenTelemetry: false\n</code></pre> <pre><code>mongodb:\n  enabled: true\n  auth:\n    rootPassword: admin\nwebapi:\n  db:\n    connectionString: mongodb://root:admin@tfbackend-mongodb:27017/terraform_backend_beta?authSource=admin\n    databaseName: terraform_backend_beta\n</code></pre> <p>Install and manage the application with Helm:</p> <pre><code>helm upgrade --install tfbackend devpro/terraform-backend-mongodb -f values.yaml \\\n  --create-namespace --namespace tfbackend\n</code></pre>"},{"location":"usage/","title":"Usage","text":""},{"location":"usage/#tenant-authentication","title":"Tenant authentication","text":"<p>API calls are secured through tenant isolation and user authentication, which are stored in the MongoDB database. User password is encrypted.</p> <p><code>tfbeadm</code> script is the easiest way to create the users correctly:</p> <pre><code>curl -O https://raw.githubusercontent.com/devpro/terraform-backend-mongodb/refs/heads/main/scripts/tfbeadm\nMONGODB_URI=mongodb://&lt;myserver&gt;:27017/&lt;mydb&gt; tfbeadm create-user &lt;myusername&gt; &lt;mypassword&gt; &lt;mytenant&gt;\n</code></pre>"},{"location":"usage/#client-configuration","title":"Client configuration","text":"<p>In the tf file, configure the backend to use the REST API:</p> <pre><code>terraform {\n  backend \"http\" {\n    address                = \"http://&lt;api-url&gt;/&lt;mytenant&gt;/state/&lt;project&gt;\"\n    lock_address           = \"http://&lt;api-url&gt;/&lt;mytenant&gt;/state/&lt;project&gt;/lock\"\n    unlock_address         = \"http://&lt;api-url&gt;/&lt;mytenant&gt;/state/&lt;project&gt;/lock\"\n    lock_method            = \"POST\"\n    unlock_method          = \"DELETE\"\n    username               = \"&lt;myusername&gt;\"\n    password               = \"&lt;mypassword&gt;\"\n    #skip_cert_verification = \"true\"\n  }\n}\n</code></pre> <p>You're now ready!</p>"}]}